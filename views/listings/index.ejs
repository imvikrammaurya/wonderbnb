<% layout('layouts/boilerplate.ejs') -%>
<body>
  <style>
  /* Main filter container */
  #filters {
    display: flex;
    flex-wrap: nowrap; /* Prevents items from wrapping to the next line */
    overflow-x: auto; /* Enables horizontal scrolling */
    align-items: center;
    /* Hide the scrollbar for different browsers */
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

  /* Hide scrollbar for Chrome, Safari and Opera */
  #filters::-webkit-scrollbar {
    display: none;
  }

  /* Individual filter icons */
  .filter {
    text-align: center;
    margin-right: 2rem;
    margin-top: 2rem;
    opacity: 0.7;
    cursor: pointer;
    flex-shrink: 0; /* Prevents icons from shrinking */
    min-width: 80px;  /* Helps control how many are visible */
  }

  .filter:hover {
    opacity: 1;
  }

  .filter p {
    font-size: 0.8rem;
  }

  /* New styles for the scroll arrow buttons */
  .filter-scroll-btn {
    border: 1px solid #ddd;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  /* Tax toggle switch */
  .tax-toggle {
    border: 1px solid black;
    border-radius: 1rem;
    height: 3.5rem;
    padding: 1rem;
    display: flex;
    align-items: center;
    flex-shrink: 0; /* Prevent toggle from shrinking */
  }

  .tax-info {
    display: none;
  }

  .filter-link {
    text-decoration: none;
    color: inherit;
  }
</style>
    <!-- <h3>All listings</h3> -->
     <div class="row align-items-center mt-3 ">

  <div class="col-md-9 col-12">
    <div class="position-relative">
      <button class="btn filter-scroll-btn position-absolute top-50 start-0 translate-middle-y" id="scroll-left" style="z-index: 10;">
        <i class="fa-solid fa-chevron-left"></i>
      </button>

      <div id="filters">
        <a href="/listings?category=Trending" class="filter-link">
        <div class="filter">
          <div><i class="fa-solid fa-fire-flame-curved"></i></div>
          <p>Trending</p>
        </div></a>
        
        <a href="/listings?category=Rooms" class="filter-link">
        <div class="filter">
          <div><i class="fa-solid fa-bed"></i></div>
          <p>Rooms</p>
        </div></a>

        <a href="/listings?category=Iconic Cities" class="filter-link">
        <div class="filter">
          <div><i class="fa-solid fa-city"></i></div>
          <p>Iconic Cities</p>
        </div></a>

        <a href="/listings?category=Mountains" class="filter-link">
        <div class="filter">
          <div><i class="fa-solid fa-mountain-city"></i></div>
          <p>Mountains</p>
        </div></a>

        <a href="/listings?category=Castles" class="filter-link">
        <div class="filter">
          <div><i class="fa-brands fa-fort-awesome"></i></div>
          <p>Castles</p>
        </div></a>

        <a href="/listings?category=Amazing Pools" class="filter-link">
        <div class="filter">
          <div><i class="fa-solid fa-person-swimming"></i></div>
          <p>Amazing Pools</p>
        </div></a>

        <a href="/listings?category=Arctic" class="filter-link">
        <div class="filter">
          <div><i class="fa-solid fa-snowflake"></i></div>
          <p>Arctic</p>
        </div></a>

        <a href="/listings?category=Camping" class="filter-link">
        <div class="filter">
          <div><i class="fa-solid fa-campground"></i></div>
          <p>Camping</p>
        </div></a>

        <a href="/listings?category=Dome" class="filter-link">
        <div class="filter">
          <div><i class="fa-solid fa-igloo"></i></div>
          <p>Dome</p>
        </div></a>

        <a href="/listings?category=Boats" class="filter-link">
        <div class="filter">
          <div><i class="fa-solid fa-ship"></i></div>
          <p>Boats</p>
        </div></a>

        <a href="/listings?category=Forms" class="filter-link">
        <div class="filter">
          <div><i class="fa-solid fa-cow"></i></div>
          <p>Farms</p>
        </div></a>
      </div>

      <button class="btn filter-scroll-btn position-absolute top-50 end-0 translate-middle-y" id="scroll-right" style="z-index: 10;">
        <i class="fa-solid fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <div class="col-md-3 col-12 d-none d-md-flex justify-content-md-end justify-content-center">
  <div class="tax-toggle">
    <div class="form-check form-switch form-check-reverse">
      <input class="form-check-input tax-switch" type="checkbox" role="switch" id="switchCheckDesktop">
      <label class="form-check-label" for="switchCheckDesktop">Display total after taxes</label>
    </div>
  </div>
</div>

</div>
    
  </div>

 
</div>
    <div class="container">
<!-- <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 justify-content-center mt-3" > -->
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
  <% for( let listing of allListings){ %>
    <div class="col">
      <div class="card listing-card h-100">
        <a href="/listings/<%= listing._id %>" class="listing-link">
          <img src="<%= listing.image.url%>" class="card-img-top" alt="Listing image" style="height: 20rem;">
          
          <div class="card-body d-flex flex-column">
            <div class="card-title-wrapper">
              <b><%= listing.title %></b>
              <% if (listing.averageRating > 0) { %>
                <%
                  let ratingClass = "";
                  if (listing.averageRating < 2) ratingClass = "rating-red";
                  else if (listing.averageRating <= 3.5) ratingClass = "rating-yellow";
                  else if (listing.averageRating <= 4.7) ratingClass = "rating-green";
                  else ratingClass = "rating-dark-green";
                %>
                <div class="rating-badge  <%= ratingClass %>">
                  <%= listing.averageRating.toFixed(1) %>
                  <i class="fa-solid fa-star"></i>
                </div>
              <% } %>
            </div>

            <p class="card-text ">
              &#8377;<%= listing.price.toLocaleString("en-IN") %> /night
              <i class="tax-info">&nbsp; &nbsp;+18%gst</i>
            </p>
          </div>
        </a>
      </div>
    </div>
  <% } %>
</div>
  
    </div>
    </div>
    <script>
  // Add this new code for the filter scroll buttons
  const filtersContainer = document.getElementById('filters');
  const scrollLeftButton = document.getElementById('scroll-left');
  const scrollRightButton = document.getElementById('scroll-right');

  scrollLeftButton.addEventListener('click', () => {
    // Scroll left by 300 pixels with a smooth animation
    filtersContainer.scrollBy({
      left: -300,
      behavior: 'smooth'
    });
  });

  scrollRightButton.addEventListener('click', () => {
    // Scroll right by 300 pixels with a smooth animation
    filtersContainer.scrollBy({
      left: 300,
      behavior: 'smooth'
    });
  });

  // Your existing tax switch code
  // In the <script> tag at the bottom of index.ejs

// Select ALL elements with the .tax-switch class
const taxSwitches = document.querySelectorAll(".tax-switch");
const taxInfos = document.getElementsByClassName("tax-info");

// Add an event listener to each switch
taxSwitches.forEach((taxSwitch) => {
  taxSwitch.addEventListener("click", () => {
    for (let info of taxInfos) {
      if (taxSwitch.checked) {
        info.style.display = "inline";
      } else {
        info.style.display = "none";
      }
    }
  });
});

// In views/listings/index.ejs <script> tag

document.addEventListener('DOMContentLoaded', () => {
    // 1. Initialize Litepicker for Date Range
    const datePicker = new Litepicker({
        element: document.getElementById('dates'),
        singleMode: false,
        tooltipText: {
            one: 'night',
            other: 'nights'
        },
        format: 'DD MMM',
    });

    // 2. Guest Dropdown Logic
    const guestInput = document.getElementById('guests');
    const guestDropdown = document.getElementById('guest-dropdown');
    
    guestInput.addEventListener('click', (event) => {
        event.stopPropagation(); // Prevents click from closing it immediately
        guestDropdown.style.display = guestDropdown.style.display === 'block' ? 'none' : 'block';
    });

    // Close dropdown if clicking outside
    document.addEventListener('click', (event) => {
        if (!guestInput.contains(event.target) && !guestDropdown.contains(event.target)) {
            guestDropdown.style.display = 'none';
        }
    });

    // 3. Counter Logic
    let adults = 1;
    let children = 0;
    const adultsCountEl = document.getElementById('adults-count');
    const childrenCountEl = document.getElementById('children-count');

    function updateGuestInput() {
        let guestText = `${adults} Adult${adults > 1 ? 's' : ''}`;
        if (children > 0) {
            guestText += `, ${children} Child${children > 1 ? 'ren' : ''}`;
        }
        guestInput.value = guestText;
    }
    updateGuestInput(); // Initial value

    document.querySelectorAll('.counter-btn').forEach(button => {
        button.addEventListener('click', () => {
            const type = button.dataset.type;
            const action = button.dataset.action;

            if (type === 'adults') {
                adults = action === 'increment' ? adults + 1 : Math.max(1, adults - 1);
                adultsCountEl.textContent = adults;
            } else {
                children = action === 'increment' ? children + 1 : Math.max(0, children - 1);
                childrenCountEl.textContent = children;
            }
            updateGuestInput();
        });
    });
});
</script>
</body>

